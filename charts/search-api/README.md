# Общая информация

## Команды helm
```shell
helm install big-search . -n <namespace> # установить чарт
helm delete big-search -n <namespace>    # удалить чарт
helm upgrade big-search . -n <namespace> # обновить чарт
```

## Blue-green deployment
Чарт поддерживает Blue-Green deployment. Для его использования в файле `values.txt` задайте значение для параметра
`bluegreen`, например:
```yaml
bluegreen: "green"
```

В этом случае значение `bluegreen` (`green` в данном случае) подставится как label ко всем сущностям в этом релизе.
Если закомментировать этот параметр или оставить его пустым, релиз развернётся с label `bluegreen: ""`.

Чарт поддерживает разворачивание нескольких релизов в одном namespace. Для этого надо поменять параметр bluegreen и имя 
релиза в команде `helm install/upgrade`.


Примеры:
```shell
helm install bs1 . -n <namespace>                       # параметр bluegreen пустой
helm install bs2 --set bluegreen=blue . -n <namespace>  # параметр bluegreen=blue
helm install bs3 --set bluegreen=green . -n <namespace> # параметр bluegreen=green
```
Таким образом у нас будет три версии поиска, которые можно отдельно обновлять/удалять/инсталлировать изолировано от 
остальных.

Можно держать стабильную рабочую версию, на которую будут идти запросы с внешнего ингресса/веб роутера, параллельно в 
том же неймспейсе можно иметь несколько версий для разработки и тестирования, с разными моделями индексов, фидов, 
структуры самого приложения и микросервисов. Убедившись в стабильности новой dev версии переключить трафик ингресса/веб
роутера c стабильной версии на dev. И также легко переключиться (откатиться обратно).

Значения `blue`/`green` весьма условные, теги могут быть любыми: `stable`, `dev`, `usrch-3456` и так далее. Их может 
быть более 2.
Ненужную версию, на которую больше не планируется направлять трафик можно удалить без эффекта на другие версии.

## Mock-сервисы для отладки и тестирования

### query-transformer-mock
В качестве mock'а для сервиса исправления опечаток у нас используется wiremock с расширением для обработки grpc.
Для его использования нужно установить `queryTransformerMock.enabled: true` в values.yaml или передать значение явно 
при установке или обновлении чарта. Поведение сервиса настраивается в секции `queryTransformerMock.config` в виде yaml 
и при установке чарта преобразуется в json-формат, читаемый wiremock. 

Более подробную информацию о настройке можно посмотреть здесь:
https://wiremock.org/docs/grpc/

## Values

### internal 2gis parametrs


### Worker settings

| Name                                                       | Description                                                                                                                                                                                  | Value                                |
| ---------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------ |
| `worker.replicaCount`                                      | Number of worker replicas (used if HPA is disabled)                                                                                                                                          | `2`                                  |
| `worker.matchLabels`                                       | Selector match labels                                                                                                                                                                        | `{}`                                 |
| `worker.podLabels`                                         | Kubernetes [pod labels](https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/)                                                                                           | `{}`                                 |
| `worker.podAnnotations`                                    | Kubernetes [pod annotations](https://kubernetes.io/docs/concepts/overview/working-with-objects/annotations/)                                                                                 | `{}`                                 |
| `worker.podSecurityContext`                                | Kubernetes [podSecurityContext](https://kubernetes.io/docs/tasks/configure-pod-container/security-context/)                                                                                  | `{}`                                 |
| `worker.imagePullSecrets`                                  | Kubernetes image pull secrets                                                                                                                                                                | `[]`                                 |
| `worker.image.repository`                                  | Image Repository                                                                                                                                                                             | `docker-hub.2gis.ru/usrch/bs-worker` |
| `worker.image.pullPolicy`                                  | Image [pull policy](https://kubernetes.io/docs/concepts/containers/images/#image-pull-policy)                                                                                                | `IfNotPresent`                       |
| `worker.image.tag`                                         | Image Tag                                                                                                                                                                                    | `0.1`                                |
| `worker.ports.http`                                        | HTTP port used by the worker                                                                                                                                                                 | `8092`                               |
| `worker.ports.grpc`                                        | gRPC port used by the worker                                                                                                                                                                 | `8091`                               |
| `worker.loggerLevel`                                       | Log level of the worker app; can be `trace`, `debug`, `info`, `warning`, `error`, or `critical`                                                                                              | `info`                               |
| `worker.loggerFormat`                                      | Log format used by the worker; Userver supports `tskv`, `ltsv`, `raw`, `json`, `json_yadeploy`. We recommend using `json`                                                                    | `json`                               |
| `worker.workerMainThreads`                                 | Number of main task processor threads                                                                                                                                                        | `4`                                  |
| `worker.workerFbThreads`                                   | Number of fallback task processor threads                                                                                                                                                    | `4`                                  |
| `worker.dataUpdateFrequencySec`                            | Frequency (in seconds) at which the worker updates data (indexes and RTW)                                                                                                                    | `60`                                 |
| `worker.rtw.lifeTime`                                      | Lifetime of Real-Time Weights (in seconds)                                                                                                                                                   | `1800`                               |
| `worker.queueLimit`                                        | Maximum number of tasks in the main task processor queue. If exceeded, tasks are sent to the fallback processor                                                                              | `30`                                 |
| `worker.executeDebugCommands`                              | Enables execution of debug commands (e.g., simulating head or worker crashes)                                                                                                                | `false`                              |
| `worker.securityContext`                                   | Kubernetes [SecurityContext](https://kubernetes.io/docs/tasks/configure-pod-container/security-context/)                                                                                     | `{}`                                 |
| `worker.resources.requests.cpu`                            | A CPU request, recommended value `1400m`                                                                                                                                                     |                                      |
| `worker.resources.requests.memory`                         | A memory request, recommended value `3840Mi`                                                                                                                                                 |                                      |
| `worker.resources.limits.cpu`                              | A CPU limit, recommended value `6000m`                                                                                                                                                       |                                      |
| `worker.resources.limits.memory`                           | A memory limit, recommended value `6Gi`                                                                                                                                                      |                                      |
| `worker.livenessProbe.enabled`                             | Enable of livenessProbe                                                                                                                                                                      | `true`                               |
| `worker.livenessProbe.httpGet.path`                        | HTTP path for livenessProbe                                                                                                                                                                  | `/status`                            |
| `worker.livenessProbe.httpGet.port`                        | HTTP port for livenessProbe                                                                                                                                                                  | `http-port`                          |
| `worker.livenessProbe.httpGet.scheme`                      | Scheme for livenessProbe                                                                                                                                                                     | `HTTP`                               |
| `worker.livenessProbe.timeoutSeconds`                      | Timeout (in seconds) for the liveness probe                                                                                                                                                  | `1`                                  |
| `worker.livenessProbe.periodSeconds`                       | Interval (in seconds) between liveness probe checks                                                                                                                                          | `5`                                  |
| `worker.livenessProbe.successThreshold`                    | Minimum consecutive successes for the readiness probe to be considered successful                                                                                                            | `1`                                  |
| `worker.livenessProbe.failureThreshold`                    | Number of failures before the readiness probe is considered failed                                                                                                                           | `36`                                 |
| `worker.readinessProbe.enabled`                            | Enable readiness probe                                                                                                                                                                       | `true`                               |
| `worker.readinessProbe.httpGet.path`                       | HTTP path for the readiness probe                                                                                                                                                            | `/status`                            |
| `worker.readinessProbe.httpGet.port`                       | HTTP port for the readiness probe                                                                                                                                                            | `http-port`                          |
| `worker.readinessProbe.httpGet.scheme`                     | HTTP scheme for the readiness probe                                                                                                                                                          | `HTTP`                               |
| `worker.readinessProbe.timeoutSeconds`                     | Timeout (in seconds) for the readiness probe                                                                                                                                                 | `1`                                  |
| `worker.readinessProbe.periodSeconds`                      | Interval (in seconds) between readiness probe checks                                                                                                                                         | `5`                                  |
| `worker.readinessProbe.successThreshold`                   | Minimum consecutive successes for the readiness probe to be considered successful                                                                                                            | `1`                                  |
| `worker.readinessProbe.failureThreshold`                   | Number of failures before the readiness probe is considered failed                                                                                                                           | `3`                                  |
| `worker.startupProbe.enabled`                              | Enable startup probe                                                                                                                                                                         | `true`                               |
| `worker.startupProbe.httpGet.path`                         | HTTP path for the startup probe                                                                                                                                                              | `/ready`                             |
| `worker.startupProbe.httpGet.port`                         | HTTP port for the startup probe                                                                                                                                                              | `http-syncer`                        |
| `worker.startupProbe.httpGet.scheme`                       | HTTP scheme for the startup probe                                                                                                                                                            | `HTTP`                               |
| `worker.startupProbe.initialDelaySeconds`                  | Initial delay (in seconds) before starting the startup probe                                                                                                                                 | `30`                                 |
| `worker.startupProbe.timeoutSeconds`                       | Timeout (in seconds) for the startup probe                                                                                                                                                   | `2`                                  |
| `worker.startupProbe.periodSeconds`                        | Interval (in seconds) between startup probe checks                                                                                                                                           | `10`                                 |
| `worker.startupProbe.successThreshold`                     | Minimum consecutive successes for the startup probe to be considered successful                                                                                                              | `1`                                  |
| `worker.startupProbe.failureThreshold`                     | Number of failures before the startup probe is considered failed                                                                                                                             | `200`                                |
| `worker.prestopHook.enabled`                               | Enable or disable the container lifecycle preStop hook                                                                                                                                       | `true`                               |
| `worker.hpa.enabled`                                       | Enable or disable Horizontal Pod Autoscaler (HPA)                                                                                                                                            | `false`                              |
| `worker.hpa.minReplicas`                                   | Lower limit for the number of replicas to which the autoscaler can scale down                                                                                                                | `36`                                 |
| `worker.hpa.maxReplicas`                                   | Upper limit for the number of replicas to which the autoscaler can scale up                                                                                                                  | `300`                                |
| `worker.hpa.averageCPUValue`                               | Target average CPU utilization (represented as a direct value of requested CPU); if not specified the default autoscaling policy will be used                                                | `1200m`                              |
| `worker.hpa.behavior.scaleDown.policies[0].periodSeconds`  | Indicates the length of time in the past for which the policy must hold true                                                                                                                 | `180`                                |
| `worker.hpa.behavior.scaleDown.policies[0].type`           | The type of amount by which the pod count should be reduced; This can be a percentage of the current pod count or a specific number of pods                                                  | `Percent`                            |
| `worker.hpa.behavior.scaleDown.policies[0].value`          | The amount by which the pod count should be increased                                                                                                                                        | `3`                                  |
| `worker.hpa.behavior.scaleDown.stabilizationWindowSeconds` | The stabilization window is used to restrict the flapping of replica count when the metrics used for scaling keep fluctuating                                                                | `1200`                               |
| `worker.hpa.behavior.scaleUp.selectPolicy`                 | By setting the value to Min which would select the policy which allows the smallest change in the replica count; Setting the value to Disabled completely disables scaling in that direction | `Min`                                |
| `worker.hpa.behavior.scaleUp.policies[0].periodSeconds`    | Indicates the length of time in the past for which the policy must hold true                                                                                                                 | `15`                                 |
| `worker.hpa.behavior.scaleUp.policies[0].type`             | The type of amount by which the pod count should be increased; This can be a percentage of the current pod count or a specific number of pods                                                | `Percent`                            |
| `worker.hpa.behavior.scaleUp.policies[0].value`            | The amount by which the pod count should be increased                                                                                                                                        | `10`                                 |
| `worker.hpa.behavior.scaleUp.policies[1].type`             | The type of amount by which the pod count should be increased; This can be a percentage of the current pod count or a specific number of pods                                                | `Pods`                               |
| `worker.hpa.behavior.scaleUp.policies[1].value`            | The amount by which the pod count should be increased                                                                                                                                        | `5`                                  |
| `worker.hpa.behavior.scaleUp.policies[1].periodSeconds`    | Indicates the length of time in the past for which the policy must hold true                                                                                                                 | `15`                                 |
| `worker.hpa.behavior.scaleUp.stabilizationWindowSeconds`   | The stabilization window is used to restrict the flapping of replica count when the metrics used for scaling keep fluctuating                                                                | `30`                                 |
| `worker.vpa.enabled`                                       | Enable or disable Vertical Pod Autoscaler (VPA)                                                                                                                                              | `true`                               |
| `worker.vpa.updateMode`                                    | VPA operating mode: `Off` means VPA will not automatically change resource requests                                                                                                          | `Off`                                |
| `worker.nodeSelector`                                      | Kubernetes [node selectors](https://kubernetes.io/docs/concepts/scheduling-eviction/assign-pod-node/#nodeselector)                                                                           | `{}`                                 |
| `worker.tolerations`                                       | Kubernetes [tolerations](https://kubernetes.io/docs/concepts/scheduling-eviction/taint-and-toleration/) settings                                                                             | `[]`                                 |
| `worker.affinity`                                          | Kubernetes pod [affinity settings](https://kubernetes.io/docs/concepts/scheduling-eviction/assign-pod-node/#node-affinity)                                                                   | `{}`                                 |
| `worker.data.persistent.enabled`                           | Enable persistent volume for the service                                                                                                                                                     | `false`                              |
| `worker.data.storageClassName`                             | Storage class to use. See Kubernetes [storageClassName](https://kubernetes.io/docs/concepts/storage/storage-classes/)                                                                        | `""`                                 |
| `worker.data.resources.requests.storage`                   | Storage volume size                                                                                                                                                                          | `8Gi`                                |
| `worker.strategy.type`                                     | Kubernetes deployment strategy. Can be `Recreate` or `RollingUpdate`. See [Strategy](https://kubernetes.io/docs/concepts/workloads/controllers/deployment/#strategy)                         | `RollingUpdate`                      |
| `worker.strategy.rollingUpdate.maxUnavailable`             | Maximum number of pods that can be unavailable during a [rolling update](https://kubernetes.io/docs/concepts/workloads/controllers/deployment/#rolling-update-deployment)                    | `5%`                                 |
| `worker.strategy.rollingUpdate.maxSurge`                   | Maximum number of extra pods that can be created during a [rolling update](https://kubernetes.io/docs/concepts/workloads/controllers/deployment/#rolling-update-deployment)                  | `5%`                                 |
| `worker.revisionHistoryLimit`                              | Number of old ReplicaSets to retain for [rollback](https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/)                                                           | `10`                                 |

### Head settings

| Name                                                                  | Description                                                                                                                                                                                                                                      | Value                                                    |
|-----------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------|
| `head.replicaCount`                                                   | Number of head replicas (used if HPA is disabled)                                                                                                                                                                                                | `1`                                                      |
| `head.matchLabels`                                                    | Selector match labels                                                                                                                                                                                                                            | `{}`                                                     |
| `head.podLabels`                                                      | Kubernetes [pod labels](https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/)                                                                                                                                               | `{}`                                                     |
| `head.podAnnotations`                                                 | Kubernetes [pod annotations](https://kubernetes.io/docs/concepts/overview/working-with-objects/annotations/)                                                                                                                                     | `{}`                                                     |
| `head.podSecurityContext`                                             | Kubernetes [podSecurityContext](https://kubernetes.io/docs/tasks/configure-pod-container/security-context/)                                                                                                                                      | `{}`                                                     |
| `head.imagePullSecrets`                                               | Kubernetes image pull secrets                                                                                                                                                                                                                    | `[]`                                                     |
| `head.head.image.repository`                                          | Docker image repository                                                                                                                                                                                                                          | `docker-hub.2gis.ru/usrch/bs-head`                       |
| `head.head.image.pullPolicy`                                          | Image [pull policy](https://kubernetes.io/docs/concepts/containers/images/#image-pull-policy)                                                                                                                                                    | `IfNotPresent`                                           |
| `head.head.image.tag`                                                 | Docker image tag                                                                                                                                                                                                                                 | `0.1`                                                    |
| `head.head.ports.http`                                                | TCP port for requests to the Head service                                                                                                                                                                                                        | `9090`                                                   |
| `head.head.ports.monitor`                                             | TCP port for service endpoints such as /metrics, etc.                                                                                                                                                                                            | `9091`                                                   |
| `head.head.securityContext`                                           | Kubernetes [SecurityContext](https://kubernetes.io/docs/tasks/configure-pod-container/security-context/)                                                                                                                                         | `{}`                                                     |
| `head.head.resources.requests.cpu`                                    | CPU request; recommended value: `900m`                                                                                                                                                                                                           |                                                          |
| `head.head.resources.requests.memory`                                 | Memory request; recommended value: `4600Mi`                                                                                                                                                                                                      |                                                          |
| `head.head.resources.limits.cpu`                                      | CPU limit; recommended value: `2000m`                                                                                                                                                                                                            |                                                          |
| `head.head.resources.limits.memory`                                   | Memory limit; recommended value: `8Gi`                                                                                                                                                                                                           |                                                          |
| `head.head.loggerLevel`                                               | Log level of the Head app; can be `trace`, `debug`, `info`, `warning`, `error`, or `critical`                                                                                                                                                    | `info`                                                   |
| `head.head.loggerFormat`                                              | Log format used by the Head app; Userver supports `tskv`, `ltsv`, `raw`, `json`, `json_yadeploy`. We recommend using `json`                                                                                                                      | `json`                                                   |
| `head.head.livenessProbe.enabled`                                     | Enable liveness probe                                                                                                                                                                                                                            | `true`                                                   |
| `head.head.livenessProbe.httpGet.path`                                | HTTP path for the liveness probe                                                                                                                                                                                                                 | `/v2/status`                                             |
| `head.head.livenessProbe.httpGet.port`                                | HTTP port for the liveness probe                                                                                                                                                                                                                 | `http-nginx`                                             |
| `head.head.livenessProbe.httpGet.scheme`                              | HTTP scheme for the liveness probe                                                                                                                                                                                                               | `HTTP`                                                   |
| `head.head.livenessProbe.timeoutSeconds`                              | Timeout (in seconds) for the liveness probe                                                                                                                                                                                                      | `1`                                                      |
| `head.head.livenessProbe.periodSeconds`                               | Interval (in seconds) between liveness probe checks                                                                                                                                                                                              | `5`                                                      |
| `head.head.livenessProbe.successThreshold`                            | Minimum consecutive successes for the liveness probe to be considered successful                                                                                                                                                                 | `1`                                                      |
| `head.head.livenessProbe.failureThreshold`                            | Number of failures before the liveness probe is considered failed                                                                                                                                                                                | `36`                                                     |
| `head.head.readinessProbe.enabled`                                    | Enable readiness probe                                                                                                                                                                                                                           | `true`                                                   |
| `head.head.readinessProbe.httpGet.path`                               | HTTP path for the readiness probe                                                                                                                                                                                                                | `/v2/search?q=55899224549773365&seg=1&searcher=Searcher` |
| `head.head.readinessProbe.httpGet.port`                               | HTTP port for the readiness probe                                                                                                                                                                                                                | `http-nginx`                                             |
| `head.head.readinessProbe.httpGet.scheme`                             | HTTP scheme for the readiness probe                                                                                                                                                                                                              | `HTTP`                                                   |
| `head.head.readinessProbe.timeoutSeconds`                             | Timeout (in seconds) for the readiness probe                                                                                                                                                                                                     | `1`                                                      |
| `head.head.readinessProbe.periodSeconds`                              | Interval (in seconds) between readiness probe checks                                                                                                                                                                                             | `5`                                                      |
| `head.head.readinessProbe.successThreshold`                           | Minimum consecutive successes for the readiness probe to be considered successful                                                                                                                                                                | `1`                                                      |
| `head.head.readinessProbe.failureThreshold`                           | Number of failures before the readiness probe is considered failed                                                                                                                                                                               | `3`                                                      |
| `head.head.startupProbe.enabled`                                      | Enable startup probe                                                                                                                                                                                                                             | `true`                                                   |
| `head.head.startupProbe.httpGet.path`                                 | HTTP path for the startup probe                                                                                                                                                                                                                  | `/ready`                                                 |
| `head.head.startupProbe.httpGet.port`                                 | HTTP port for the startup probe                                                                                                                                                                                                                  | `http-syncer`                                            |
| `head.head.startupProbe.httpGet.scheme`                               | HTTP scheme for the startup probe                                                                                                                                                                                                                | `HTTP`                                                   |
| `head.head.startupProbe.initialDelaySeconds`                          | Initial delay (in seconds) before starting the startup probe                                                                                                                                                                                     | `30`                                                     |
| `head.head.startupProbe.timeoutSeconds`                               | Timeout (in seconds) for the startup probe                                                                                                                                                                                                       | `2`                                                      |
| `head.head.startupProbe.periodSeconds`                                | Interval (in seconds) between startup probe checks                                                                                                                                                                                               | `10`                                                     |
| `head.head.startupProbe.successThreshold`                             | Minimum consecutive successes for the startup probe to be considered successful                                                                                                                                                                  | `1`                                                      |
| `head.head.startupProbe.failureThreshold`                             | Number of failures before the startup probe is considered failed                                                                                                                                                                                 | `200`                                                    |
| `head.head.allowSearchExtendedParams`                                 | Allow passing debug parameters in the request                                                                                                                                                                                                    | `true`                                                   |
| `head.head.prestopHook.enabled`                                       | Enable or disable the container lifecycle preStop hook                                                                                                                                                                                           | `true`                                                   |
| `head.head.workerQueriesCount`                                        | Number of parts into which a request is split before being sent to workers (map operation in map-reduce)                                                                                                                                         | `32`                                                     |
| `head.head.workerRetryAttempts`                                       | Number of retry attempts to contact a worker                                                                                                                                                                                                     | `1`                                                      |
| `head.head.workerTimeoutMs`                                           | Timeout (in milliseconds) for waiting for a response from a worker                                                                                                                                                                               | `2000`                                                   |
| `head.head.adsEnable`                                                 | Enable or disable advertising                                                                                                                                                                                                                    | `true`                                                   |
| `head.head.bigSearchMode`                                             | Enable or disable big search (`on`, `off`, or `default`)                                                                                                                                                                                         | `on`                                                     |
| `head.head.bigSearchSearchers`                                        | List of searchers for which big search is enabled                                                                                                                                                                                                | `[]`                                                     |
| `head.head.aiSuggestedQueries.enabled`                                | Enable or disable AI Suggested Queries                                                                                                                                                                                                           | `true`                                                   |
| `head.head.executeDebugCommands`                                      | Enable execution of debug commands (e.g., simulating head or worker crashes)                                                                                                                                                                     | `false`                                                  |
| `head.head.throttle.enabled`                                          | Enable or disable big search throttling                                                                                                                                                                                                          | `true`                                                   |
| `head.head.throttle.threshold`                                        | Threshold value beyond which throttling is activated                                                                                                                                                                                             | `250`                                                    |
| `head.head.throttle.engageFactor`                                     | Throttling engage rate                                                                                                                                                                                                                           | `60`                                                     |
| `head.head.throttle.releaseFactor`                                    | Throttling release rate                                                                                                                                                                                                                          | `20`                                                     |
| `head.head.throttle.updateIntervalSeconds`                            | Interval (in seconds) for updating the throttling level                                                                                                                                                                                          | `1`                                                      |
| `head.head.throttle.inputMetric.updateIntervalSeconds`                | Interval (in seconds) for updating the input metric value                                                                                                                                                                                        | `5`                                                      |
| `head.head.throttle.inputMetric.calculateForPeriods`                  | Number of update periods to use for input metric calculation                                                                                                                                                                                     | `12`                                                     |
| `head.nginx.image.repository`                                         | Docker image repository                                                                                                                                                                                                                          | `nginx`                                                  |
| `head.nginx.image.pullPolicy`                                         | Image [pull policy](https://kubernetes.io/docs/concepts/containers/images/#image-pull-policy)                                                                                                                                                    | `IfNotPresent`                                           |
| `head.nginx.image.tag`                                                | Docker image tag                                                                                                                                                                                                                                 | `1.25.3`                                                 |
| `head.nginx.ports.http`                                               | HTTP port used by Nginx                                                                                                                                                                                                                          | `8080`                                                   |
| `head.nginx.securityContext`                                          | Kubernetes [SecurityContext](https://kubernetes.io/docs/tasks/configure-pod-container/security-context/)                                                                                                                                         | `{}`                                                     |
| `head.nginx.resources.requests.cpu`                                   | CPU request; recommended value: `100m`                                                                                                                                                                                                           |                                                          |
| `head.nginx.resources.requests.memory`                                | Memory request; recommended value: `64Mi`                                                                                                                                                                                                        |                                                          |
| `head.nginx.resources.limits.cpu`                                     | CPU limit; recommended value: `250m`                                                                                                                                                                                                             |                                                          |
| `head.nginx.resources.limits.memory`                                  | Memory limit; recommended value: `256Mi`                                                                                                                                                                                                         |                                                          |
| `head.nginx.keepAliveCount`                                           | Maximum number of idle keepalive connections to upstream servers                                                                                                                                                                                 | `100`                                                    |
| `head.nginx.enableAccessLog`                                          | Enable or disable access logs for each request (disabled to reduce log volume)                                                                                                                                                                   | `false`                                                  |
| `head.nginx.logLevel`                                                 | Log level for Nginx; can be `trace`, `debug`, `info`, `warning`, `error`, or `critical`                                                                                                                                                          | `warn`                                                   |
| `head.envoy.image.repository`                                         | Docker image repository                                                                                                                                                                                                                          | `envoyproxy/envoy`                                       |
| `head.envoy.image.pullPolicy`                                         | Image [pull policy](https://kubernetes.io/docs/concepts/containers/images/#image-pull-policy)                                                                                                                                                    | `IfNotPresent`                                           |
| `head.envoy.image.tag`                                                | Docker image tag                                                                                                                                                                                                                                 | `v1.28.0`                                                |
| `head.envoy.ports.admin`                                              | Web access port for the Envoy admin console                                                                                                                                                                                                      | `9901`                                                   |
| `head.envoy.ports.grpc`                                               | gRPC port used by Envoy                                                                                                                                                                                                                          | `8091`                                                   |
| `head.envoy.securityContext`                                          | Kubernetes [SecurityContext](https://kubernetes.io/docs/tasks/configure-pod-container/security-context/)                                                                                                                                         | `{}`                                                     |
| `head.envoy.resources.requests.cpu`                                   | CPU request; recommended value: `200m`                                                                                                                                                                                                           |                                                          |
| `head.envoy.resources.requests.memory`                                | Memory request; recommended value: `128Mi`                                                                                                                                                                                                       |                                                          |
| `head.envoy.resources.limits.cpu`                                     | CPU limit; recommended value: `800m`                                                                                                                                                                                                             |                                                          |
| `head.envoy.resources.limits.memory`                                  | Memory limit; recommended value: `512Mi`                                                                                                                                                                                                         |                                                          |
| `head.envoy.enableAccessLog`                                          | Enable or disable logging of requests passing through Envoy                                                                                                                                                                                      | `false`                                                  |
| `head.envoy.policy`                                                   | Load balancing policy; can be `ROUND_ROBIN`, `LEAST_REQUEST`, or `RANDOM`                                                                                                                                                                        | `ROUND_ROBIN`                                            |
| `head.envoy.faultInjection.enabled`                                   | Enables or disables the fault injection feature in Envoy for testing service resilience                                                                                                                                                          |                                                          |
| `head.envoy.faultInjection.clients.worker`                            | Specifies the fault injection settings for the worker client; see [Envoy Fault Injection](https://www.envoyproxy.io/docs/envoy/latest/api-v3/extensions/filters/http/fault/v3/fault.proto#extensions-filters-http-fault-v3-httpfault)            |                                                          |
| `head.envoy.faultInjection.clients.qt`                                | Specifies the fault injection settings for the query transformer client; see [Envoy Fault Injection](https://www.envoyproxy.io/docs/envoy/latest/api-v3/extensions/filters/http/fault/v3/fault.proto#extensions-filters-http-fault-v3-httpfault) |                                                          |
| `head.envoy.faultInjection.clients.ai`                                | Specifies the fault injection settings for the AI vector search client; see [Envoy Fault Injection](https://www.envoyproxy.io/docs/envoy/latest/api-v3/extensions/filters/http/fault/v3/fault.proto#extensions-filters-http-fault-v3-httpfault)  |                                                          |
| `head.initSapphireDocs.resources`                                     | **Kubernetes [resource management settings](https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/)**                                                                                                                    |                                                          |
| `head.initSapphireDocs.resources.requests.cpu`                        | CPU request; recommended value: `5m`                                                                                                                                                                                                             |                                                          |
| `head.initSapphireDocs.resources.requests.memory`                     | Memory request; recommended value: `128Mi`                                                                                                                                                                                                       |                                                          |
| `head.initSapphireDocs.resources.limits.cpu`                          | CPU limit; recommended value: `50m`                                                                                                                                                                                                              |                                                          |
| `head.initSapphireDocs.resources.limits.memory`                       | Memory limit; recommended value: `128Mi`                                                                                                                                                                                                         |                                                          |
| `head.nodeSelector`                                                   | Kubernetes [node selectors](https://kubernetes.io/docs/concepts/scheduling-eviction/assign-pod-node/#nodeselector)                                                                                                                               | `{}`                                                     |
| `head.tolerations`                                                    | Kubernetes [tolerations](https://kubernetes.io/docs/concepts/scheduling-eviction/taint-and-toleration/) settings                                                                                                                                 | `[]`                                                     |
| `head.affinity`                                                       | Kubernetes pod [affinity settings](https://kubernetes.io/docs/concepts/scheduling-eviction/assign-pod-node/#node-affinity)                                                                                                                       | `{}`                                                     |
| `head.hpa.enabled`                                                    | Enable or disable Horizontal Pod Autoscaler (HPA) for the service                                                                                                                                                                                | `false`                                                  |
| `head.hpa.minReplicas`                                                | Minimum number of replicas the autoscaler can scale down to                                                                                                                                                                                      | `2`                                                      |
| `head.hpa.maxReplicas`                                                | Maximum number of replicas the autoscaler can scale up to                                                                                                                                                                                        | `50`                                                     |
| `head.hpa.averageCPUValue`                                            | Target average CPU utilization (as a direct value of requested CPU); if not specified, the default autoscaling policy is used                                                                                                                    | `700m`                                                   |
| `head.hpa.behavior.scaleDown.policies[0].periodSeconds`               | Duration (in seconds) the policy must be true to take effect                                                                                                                                                                                     | `180`                                                    |
| `head.hpa.behavior.scaleDown.policies[0].type`                        | Type of scaling (percentage or absolute number of pods to reduce)                                                                                                                                                                                | `Percent`                                                |
| `head.hpa.behavior.scaleDown.policies[0].value`                       | Number or percentage of pods to reduce                                                                                                                                                                                                           | `3`                                                      |
| `head.hpa.behavior.scaleDown.stabilizationWindowSeconds`              | Stabilization window to prevent frequent replica count changes due to metric fluctuations                                                                                                                                                        | `600`                                                    |
| `head.hpa.behavior.scaleUp.selectPolicy`                              | Policy selection strategy: `Min` selects the smallest change; `Disabled` disables scaling in this direction                                                                                                                                      | `Max`                                                    |
| `head.hpa.behavior.scaleUp.policies[0].periodSeconds`                 | Duration (in seconds) the policy must be true to take effect                                                                                                                                                                                     | `15`                                                     |
| `head.hpa.behavior.scaleUp.policies[0].type`                          | Type of scaling (percentage or absolute number of pods to increase)                                                                                                                                                                              | `Percent`                                                |
| `head.hpa.behavior.scaleUp.policies[0].value`                         | Number or percentage of pods to increase                                                                                                                                                                                                         | `10`                                                     |
| `head.hpa.behavior.scaleUp.stabilizationWindowSeconds`                | Stabilization window to prevent frequent replica count changes due to metric fluctuations                                                                                                                                                        | `30`                                                     |
| `head.vpa.enabled`                                                    | Enable or disable Vertical Pod Autoscaler (VPA)                                                                                                                                                                                                  | `true`                                                   |
| `head.vpa.updateMode`                                                 | VPA operating mode: `Off` means VPA will not automatically change resource requests                                                                                                                                                              | `Off`                                                    |
| `head.queryTransformer.enabled`                                       | Enable or disable the queryTransformer                                                                                                                                                                                                           | `false`                                                  |
| `head.queryTransformer.searchersList`                                 | List of searchers for which the queryTransformer will be enabled                                                                                                                                                                                 | `[]`                                                     |
| `head.queryTransformer.endpoint.address`                              | Address of the queryTransformer service                                                                                                                                                                                                          | `""`                                                     |
| `head.queryTransformer.endpoint.port`                                 | Port of the queryTransformer service                                                                                                                                                                                                             | `6767`                                                   |
| `head.queryTransformer.endpoint.ssl`                                  | Enable or disable TLS encryption for the queryTransformer service                                                                                                                                                                                | `false`                                                  |
| `head.queryTransformer.timeoutMs`                                     | Connection timeout (in milliseconds) for the queryTransformer service                                                                                                                                                                            | `20`                                                     |
| `head.aiVectorSearch.enabled`                                         | Enable or disable aiVectorSearch                                                                                                                                                                                                                 | `false`                                                  |
| `head.aiVectorSearch.endpoint.address`                                | Address of the aiVectorSearch service                                                                                                                                                                                                            | `router-grpc-service.nlp.svc.cluster.local`              |
| `head.aiVectorSearch.endpoint.port`                                   | Port of the aiVectorSearch service                                                                                                                                                                                                               | `50051`                                                  |
| `head.aiVectorSearch.endpoint.ssl`                                    | Enable or disable TLS encryption for the aiVectorSearch service                                                                                                                                                                                  | `false`                                                  |
| `head.aiVectorSearch.clientFactoryName`                               | Client factory name for the aiVectorSearch client (used to enable/disable SSL when debugging locally)                                                                                                                                            | `grpc-client-factory`                                    |
| `head.aiVectorSearch.timeout_ms`                                      | Connection timeout (in milliseconds) for the aiVectorSearch service                                                                                                                                                                              | `500`                                                    |
| `head.aiVectorSearch.searchers`                                       | List of searchers for which aiVectorSearch will be enabled                                                                                                                                                                                       | `["ExpandingSearcher"]`                                  |
| `head.grpcClientCircuitBreaker.clients`                               | List of gRPC client circuit breaker configurations, each defining thresholds and behavior per client                                                                                                                                             |                                                          |
| `head.grpcClientCircuitBreaker.clients.name`                          | Name of the gRPC client                                                                                                                                                                                                                          |                                                          |
| `head.grpcClientCircuitBreaker.clients.service_name`                  | The name of the gRPC service associated with this client                                                                                                                                                                                         |                                                          |
| `head.grpcClientCircuitBreaker.clients.enabled`                       | Enables or disables the circuit breaker for this client                                                                                                                                                                                          |                                                          |
| `head.grpcClientCircuitBreaker.clients.threshold`                     | Threshold success rate percentage. Below this value, the circuit breaker opens                                                                                                                                                                   |                                                          |
| `head.grpcClientCircuitBreaker.clients.minimum_observations_required` | Minimum number of requests required before evaluating circuit breaker conditions                                                                                                                                                                 |                                                          |
| `head.grpcClientCircuitBreaker.clients.restore_delay_seconds`         | Time in seconds the circuit breaker stays open before retrying the connection                                                                                                                                                                    |                                                          |
| `head.grpcClientCircuitBreaker.clients.restore_jitter_percent`        | Percentage used to randomize restore delay to avoid request spikes                                                                                                                                                                               |                                                          |
| `head.grpcClientCircuitBreaker.clients.update_interval_seconds`       | Frequency in seconds for circuit breaker metrics update and evaluation                                                                                                                                                                           |                                                          |
| `head.grpcClientCircuitBreaker.clients.lookback_periods`              | Number of past metric update periods to look back when assessing success rate                                                                                                                                                                    |                                                          |
| `head.data.persistent.enabled`                                        | Enable or disable a persistent volume for the service                                                                                                                                                                                            | `false`                                                  |
| `head.data.storageClassName`                                          | Storage class to use; see Kubernetes [storageClassName](https://kubernetes.io/docs/concepts/storage/storage-classes/)                                                                                                                            | `""`                                                     |
| `head.data.resources.requests.storage`                                | Requested storage volume size                                                                                                                                                                                                                    | `8Gi`                                                    |
| `head.strategy.type`                                                  | Type of Kubernetes deployment strategy; can be `Recreate` or `RollingUpdate`. See [Strategy](https://kubernetes.io/docs/concepts/workloads/controllers/deployment/#strategy)                                                                     | `RollingUpdate`                                          |
| `head.strategy.rollingUpdate.maxUnavailable`                          | Maximum number of pods that can be unavailable during a [rolling update](https://kubernetes.io/docs/concepts/workloads/controllers/deployment/#rolling-update-deployment)                                                                        | `5%`                                                     |
| `head.strategy.rollingUpdate.maxSurge`                                | Maximum number of extra pods that can be created during a [rolling update](https://kubernetes.io/docs/concepts/workloads/controllers/deployment/#rolling-update-deployment)                                                                      | `5%`                                                     |
| `head.revisionHistoryLimit`                                           | Number of old ReplicaSets to retain for [rollback](https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/) purposes                                                                                                      | `10`                                                     |
| `indexerServices.externalFilesStorageUrl`                             | Enable and define the external index storage URL; if empty, a custom indexing and storage system will be deployed                                                                                                                                | `""`                                                     |

### FileStorage settings

| Name                                              | Description                                                                                                                | Value                                       |
| ------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------- |
| `filesStorage.matchLabels`                        | Selector match labels                                                                                                      | `{}`                                        |
| `filesStorage.podLabels`                          | Kubernetes [pod labels](https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/)                         | `{}`                                        |
| `filesStorage.podAnnotations`                     | Kubernetes [pod annotations](https://kubernetes.io/docs/concepts/overview/working-with-objects/annotations/)               | `{}`                                        |
| `filesStorage.ports.http`                         | HTTP port for REST API requests of the indexing system                                                                     | `8080`                                      |
| `filesStorage.image.pullPolicy`                   | Image [pull policy](https://kubernetes.io/docs/concepts/containers/images/#image-pull-policy)                              | `IfNotPresent`                              |
| `filesStorage.image.repository`                   | Docker image repository                                                                                                    | `docker-hub.2gis.ru/usrch/bs-files_storage` |
| `filesStorage.image.tag`                          | Docker image tag                                                                                                           | `0.3`                                       |
| `filesStorage.podSecurityContext`                 | Kubernetes [podSecurityContext](https://kubernetes.io/docs/tasks/configure-pod-container/security-context/)                | `{}`                                        |
| `filesStorage.imagePullSecrets`                   | Kubernetes image pull secrets                                                                                              | `[]`                                        |
| `filesStorage.nodeSelector`                       | Kubernetes [node selectors](https://kubernetes.io/docs/concepts/scheduling-eviction/assign-pod-node/#nodeselector)         | `{}`                                        |
| `filesStorage.tolerations`                        | Kubernetes [tolerations](https://kubernetes.io/docs/concepts/scheduling-eviction/taint-and-toleration/) settings           | `[]`                                        |
| `filesStorage.affinity`                           | Kubernetes pod [affinity settings](https://kubernetes.io/docs/concepts/scheduling-eviction/assign-pod-node/#node-affinity) | `{}`                                        |
| `filesStorage.resources.requests.cpu`             | CPU request; recommended value: `500m`                                                                                     |                                             |
| `filesStorage.resources.requests.memory`          | Memory request; recommended value: `2Gi`                                                                                   |                                             |
| `filesStorage.resources.limits.cpu`               | CPU limit; recommended value: `8000m`                                                                                      |                                             |
| `filesStorage.resources.limits.memory`            | Memory limit; recommended value: `4Gi`                                                                                     |                                             |
| `filesStorage.livenessProbe.enabled`              | Enable liveness probe                                                                                                      | `true`                                      |
| `filesStorage.livenessProbe.httpGet.path`         | HTTP path for the liveness probe                                                                                           | `/ping`                                     |
| `filesStorage.livenessProbe.httpGet.port`         | HTTP port for the liveness probe                                                                                           | `http`                                      |
| `filesStorage.livenessProbe.periodSeconds`        | Interval (in seconds) between liveness probe checks                                                                        | `5`                                         |
| `filesStorage.livenessProbe.timeoutSeconds`       | Timeout (in seconds) for the liveness probe                                                                                | `1`                                         |
| `filesStorage.livenessProbe.failureThreshold`     | Number of failures before the liveness probe is considered failed                                                          | `3`                                         |
| `filesStorage.livenessProbe.initialDelaySeconds`  | Initial delay (in seconds) before starting the liveness probe                                                              | `10`                                        |
| `filesStorage.readinessProbe.enabled`             | Enable readiness probe                                                                                                     | `true`                                      |
| `filesStorage.readinessProbe.httpGet.path`        | HTTP path for the readiness probe                                                                                          | `/ping`                                     |
| `filesStorage.readinessProbe.httpGet.port`        | HTTP port for the readiness probe                                                                                          | `http`                                      |
| `filesStorage.readinessProbe.periodSeconds`       | Interval (in seconds) between readiness probe checks                                                                       | `5`                                         |
| `filesStorage.readinessProbe.timeoutSeconds`      | Timeout (in seconds) for the readiness probe                                                                               | `1`                                         |
| `filesStorage.readinessProbe.failureThreshold`    | Number of failures before the readiness probe is considered failed                                                         | `3`                                         |
| `filesStorage.readinessProbe.initialDelaySeconds` | Initial delay (in seconds) before starting the readiness probe                                                             | `10`                                        |
| `filesStorage.version_ttl`                        | Time to live for old (unused) index versions                                                                               | `168h`                                      |
| `filesStorage.loglevel`                           | Log level; can be `trace`, `debug`, `info`, `warning`, `error`, or `critical`                                              | `info`                                      |
| `filesStorage.data.persistent.enabled`            | Enable or disable a persistent volume for the service                                                                      | `false`                                     |
| `filesStorage.data.storageClassName`              | Storage class to use; see Kubernetes [storageClassName](https://kubernetes.io/docs/concepts/storage/storage-classes/)      | `""`                                        |
| `filesStorage.data.resources.requests.storage`    | Requested storage volume size                                                                                              | `30Gi`                                      |

### Controller settings

| Name                                            | Description                                                                                                                | Value                                                                                                                |
| ----------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------- |
| `controller.matchLabels`                        | Selector match labels                                                                                                      | `{}`                                                                                                                 |
| `controller.podLabels`                          | Kubernetes [pod labels](https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/)                         | `{}`                                                                                                                 |
| `controller.podAnnotations`                     | Kubernetes [pod annotations](https://kubernetes.io/docs/concepts/overview/working-with-objects/annotations/)               | `{}`                                                                                                                 |
| `controller.ports.http`                         | HTTP port for REST API requests of the indexing system                                                                     | `8080`                                                                                                               |
| `controller.image.repository`                   | Docker image repository                                                                                                    | `docker-hub.2gis.ru/usrch/bs-controller`                                                                             |
| `controller.image.pullPolicy`                   | Image [pull policy](https://kubernetes.io/docs/concepts/containers/images/#image-pull-policy)                              | `IfNotPresent`                                                                                                       |
| `controller.image.tag`                          | Docker image tag                                                                                                           | `0.3`                                                                                                                |
| `controller.podSecurityContext`                 | Kubernetes [podSecurityContext](https://kubernetes.io/docs/tasks/configure-pod-container/security-context/)                | `{}`                                                                                                                 |
| `controller.imagePullSecrets`                   | Kubernetes image pull secrets                                                                                              | `[]`                                                                                                                 |
| `controller.nodeSelector`                       | Kubernetes [node selectors](https://kubernetes.io/docs/concepts/scheduling-eviction/assign-pod-node/#nodeselector)         | `{}`                                                                                                                 |
| `controller.tolerations`                        | Kubernetes [tolerations](https://kubernetes.io/docs/concepts/scheduling-eviction/taint-and-toleration/) settings           | `[]`                                                                                                                 |
| `controller.affinity`                           | Kubernetes pod [affinity settings](https://kubernetes.io/docs/concepts/scheduling-eviction/assign-pod-node/#node-affinity) | `{}`                                                                                                                 |
| `controller.resources.requests.cpu`             | CPU request; recommended value: `100m`                                                                                     |                                                                                                                      |
| `controller.resources.requests.memory`          | Memory request; recommended value: `50Mi`                                                                                  |                                                                                                                      |
| `controller.resources.limits.cpu`               | CPU limit; recommended value: `200m`                                                                                       |                                                                                                                      |
| `controller.resources.limits.memory`            | Memory limit; recommended value: `1Gi`                                                                                     |                                                                                                                      |
| `controller.livenessProbe.enabled`              | Enable liveness probe                                                                                                      | `true`                                                                                                               |
| `controller.livenessProbe.httpGet.path`         | HTTP path for the liveness probe                                                                                           | `/ping`                                                                                                              |
| `controller.livenessProbe.httpGet.port`         | HTTP port for the liveness probe                                                                                           | `http`                                                                                                               |
| `controller.livenessProbe.periodSeconds`        | Interval (in seconds) between liveness probe checks                                                                        | `5`                                                                                                                  |
| `controller.livenessProbe.timeoutSeconds`       | Timeout (in seconds) for the liveness probe                                                                                | `1`                                                                                                                  |
| `controller.livenessProbe.failureThreshold`     | Number of failures before the liveness probe is considered failed                                                          | `3`                                                                                                                  |
| `controller.livenessProbe.initialDelaySeconds`  | Initial delay (in seconds) before starting the liveness probe                                                              | `10`                                                                                                                 |
| `controller.readinessProbe.enabled`             | Enable readiness probe                                                                                                     | `true`                                                                                                               |
| `controller.readinessProbe.httpGet.path`        | HTTP path for the readiness probe                                                                                          | `/ping`                                                                                                              |
| `controller.readinessProbe.httpGet.port`        | HTTP port for the readiness probe                                                                                          | `http`                                                                                                               |
| `controller.readinessProbe.periodSeconds`       | Interval (in seconds) between readiness probe checks                                                                       | `5`                                                                                                                  |
| `controller.readinessProbe.timeoutSeconds`      | Timeout (in seconds) for the readiness probe                                                                               | `1`                                                                                                                  |
| `controller.readinessProbe.failureThreshold`    | Number of failures before the readiness probe is considered failed                                                         | `3`                                                                                                                  |
| `controller.readinessProbe.initialDelaySeconds` | Initial delay (in seconds) before starting the readiness probe                                                             | `10`                                                                                                                 |
| `controller.loglevel`                           | Log level; can be `trace`, `debug`, `info`, `warning`, `error`, or `critical`                                              | `info`                                                                                                               |
| `controller.projectListUrl`                     | URL of the project list for indexing                                                                                       | `""`                                                                                                                 |
| `controller.user`                               | Username for accessing the indexing project list                                                                           | `""`                                                                                                                 |
| `controller.password`                           | Password for accessing the indexing project list                                                                           | `""`                                                                                                                 |
| `controller.model`                              | Part of the index name                                                                                                     | `gis`                                                                                                                |
| `controller.domain`                             | Part of the index name                                                                                                     | `v4`                                                                                                                 |
| `controller.interval`                           | Indexing task synchronization interval                                                                                     | `15s`                                                                                                                |
| `controller.task_timeout`                       | Timeout for completing an indexing task; after this time, the task is returned to the queue if not completed successfully  | `20m`                                                                                                                |
| `controller.extra_projects`                     | Additional list of projects with their URLs                                                                                | `[]`                                                                                                                 |
| `controller.adWeightsEnable`                    | Enable or disable updating of ad weights                                                                                   | `true`                                                                                                               |
| `controller.adWeightsUrl`                       | URL of the ad weights source                                                                                               | `https://delivery.api.2gis.ru/api/1.0/options?segment_id=%d&options=serp_weight_value,suggestor_weight_value,target` |
| `controller.monthlyAdWeightsEnable`             | Enable monthly update of ad targeting                                                                                      | `false`                                                                                                              |
| `controller.monthlyAdWeightsTargetingsUrl`      | URL of the monthly ad targeting source                                                                                     | `https://casino-oracle-uploader-production.k8s.n3.2gis.io/ads_weights/targetings`                                    |
| `controller.monthlyAdWeightsUrl`                | URL of a specific monthly ad weight target                                                                                 | `https://casino-oracle-uploader-production.k8s.n3.2gis.io/ads_weights/`                                              |
| `controller.data.persistent.enabled`            | Enable or disable a persistent volume for the service                                                                      | `false`                                                                                                              |
| `controller.data.storageClassName`              | Storage class to use; see Kubernetes [storageClassName](https://kubernetes.io/docs/concepts/storage/storage-classes/)      | `""`                                                                                                                 |
| `controller.data.resources.requests.storage`    | Requested storage volume size                                                                                              | `10Gi`                                                                                                               |
| `controller.notAllowedProjectKeys`              | List of projects from the general list that should not be indexed                                                          | `[]`                                                                                                                 |

### Indexer settings

| Name                                                        | Description                                                                                                                   | Value                                 |
| ----------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------- | ------------------------------------- |
| `indexer.matchLabels`                                       | Selector match labels                                                                                                         | `{}`                                  |
| `indexer.podLabels`                                         | Kubernetes [pod labels](https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/)                            | `{}`                                  |
| `indexer.podAnnotations`                                    | Kubernetes [pod annotations](https://kubernetes.io/docs/concepts/overview/working-with-objects/annotations/)                  | `{}`                                  |
| `indexer.replicaCount`                                      | Number of indexer replicas (used if HPA is disabled)                                                                          | `3`                                   |
| `indexer.ports.http`                                        | HTTP port for REST API requests of the indexing system                                                                        | `8080`                                |
| `indexer.loglevel`                                          | Log level; can be `trace`, `debug`, `info`, `warning`, `error`, or `critical`                                                 | `info`                                |
| `indexer.image.repository`                                  | Docker image repository                                                                                                       | `docker-hub.2gis.ru/usrch/bs-indexer` |
| `indexer.image.pullPolicy`                                  | Image [pull policy](https://kubernetes.io/docs/concepts/containers/images/#image-pull-policy)                                 | `IfNotPresent`                        |
| `indexer.image.tag`                                         | Docker image tag                                                                                                              | `0.3`                                 |
| `indexer.podSecurityContext`                                | Kubernetes [podSecurityContext](https://kubernetes.io/docs/tasks/configure-pod-container/security-context/)                   | `{}`                                  |
| `indexer.imagePullSecrets`                                  | Kubernetes image pull secrets                                                                                                 | `[]`                                  |
| `indexer.nodeSelector`                                      | Kubernetes [node selectors](https://kubernetes.io/docs/concepts/scheduling-eviction/assign-pod-node/#nodeselector)            | `{}`                                  |
| `indexer.tolerations`                                       | Kubernetes [tolerations](https://kubernetes.io/docs/concepts/scheduling-eviction/taint-and-toleration/) settings              | `[]`                                  |
| `indexer.affinity`                                          | Kubernetes pod [affinity settings](https://kubernetes.io/docs/concepts/scheduling-eviction/assign-pod-node/#node-affinity)    | `{}`                                  |
| `indexer.resources.requests.cpu`                            | CPU request; recommended value: `500m`                                                                                        |                                       |
| `indexer.resources.requests.memory`                         | Memory request; recommended value: `2Gi`                                                                                      |                                       |
| `indexer.resources.limits.cpu`                              | CPU limit; recommended value: `4000m`                                                                                         |                                       |
| `indexer.resources.limits.memory`                           | Memory limit; recommended value: `16Gi`                                                                                       |                                       |
| `indexer.livenessProbe.enabled`                             | Enable liveness probe                                                                                                         | `true`                                |
| `indexer.livenessProbe.httpGet.path`                        | HTTP path for the liveness probe                                                                                              | `/ping`                               |
| `indexer.livenessProbe.httpGet.port`                        | HTTP port for the liveness probe                                                                                              | `http`                                |
| `indexer.livenessProbe.periodSeconds`                       | Interval (in seconds) between liveness probe checks                                                                           | `5`                                   |
| `indexer.livenessProbe.timeoutSeconds`                      | Timeout (in seconds) for the liveness probe                                                                                   | `1`                                   |
| `indexer.livenessProbe.failureThreshold`                    | Number of failures before the liveness probe is considered failed                                                             | `3`                                   |
| `indexer.livenessProbe.initialDelaySeconds`                 | Initial delay (in seconds) before starting the liveness probe                                                                 | `10`                                  |
| `indexer.readinessProbe.enabled`                            | Enable readiness probe                                                                                                        | `true`                                |
| `indexer.readinessProbe.httpGet.path`                       | HTTP path for the readiness probe                                                                                             | `/ping`                               |
| `indexer.readinessProbe.httpGet.port`                       | HTTP port for the readiness probe                                                                                             | `http`                                |
| `indexer.readinessProbe.periodSeconds`                      | Interval (in seconds) between readiness probe checks                                                                          | `5`                                   |
| `indexer.readinessProbe.timeoutSeconds`                     | Timeout (in seconds) for the readiness probe                                                                                  | `1`                                   |
| `indexer.readinessProbe.failureThreshold`                   | Number of failures before the readiness probe is considered failed                                                            | `3`                                   |
| `indexer.readinessProbe.initialDelaySeconds`                | Initial delay (in seconds) before starting the readiness probe                                                                | `10`                                  |
| `indexer.hpa.enabled`                                       | Enable or disable Horizontal Pod Autoscaler (HPA)                                                                             | `false`                               |
| `indexer.hpa.minReplicas`                                   | Minimum number of replicas the autoscaler can scale down to                                                                   | `2`                                   |
| `indexer.hpa.maxReplicas`                                   | Maximum number of replicas the autoscaler can scale up to                                                                     | `50`                                  |
| `indexer.hpa.averageCPUValue`                               | Target average CPU utilization (as a direct value of requested CPU); if not specified, the default autoscaling policy is used | `600m`                                |
| `indexer.hpa.behavior.scaleDown.policies[0].periodSeconds`  | Duration (in seconds) the policy must be true to take effect                                                                  | `15`                                  |
| `indexer.hpa.behavior.scaleDown.policies[0].type`           | Type of scaling (percentage or absolute number of pods to reduce)                                                             | `Percent`                             |
| `indexer.hpa.behavior.scaleDown.policies[0].value`          | Number or percentage of pods to reduce                                                                                        | `100`                                 |
| `indexer.hpa.behavior.scaleDown.stabilizationWindowSeconds` | Stabilization window to prevent frequent replica count changes due to metric fluctuations                                     | `60`                                  |
| `indexer.hpa.behavior.scaleUp.selectPolicy`                 | Policy selection strategy: `Min` selects the smallest change; `Disabled` disables scaling in this direction                   | `Max`                                 |
| `indexer.hpa.behavior.scaleUp.policies[0].periodSeconds`    | Duration (in seconds) the policy must be true to take effect                                                                  | `15`                                  |
| `indexer.hpa.behavior.scaleUp.policies[0].type`             | Type of scaling (percentage or absolute number of pods to increase)                                                           | `Percent`                             |
| `indexer.hpa.behavior.scaleUp.policies[0].value`            | Number or percentage of pods to increase                                                                                      | `100`                                 |
| `indexer.hpa.behavior.scaleUp.stabilizationWindowSeconds`   | Stabilization window to prevent frequent replica count changes due to metric fluctuations                                     | `0`                                   |
| `indexer.vpa.enabled`                                       | Enable or disable Vertical Pod Autoscaler (VPA)                                                                               | `true`                                |
| `indexer.vpa.updateMode`                                    | VPA operating mode: `Off` means VPA will not automatically change resource requests                                           | `Off`                                 |

### s3Client settings

| Name                       | Description                                          | Value   |
| -------------------------- | ---------------------------------------------------- | ------- |
| `s3Client.enabled`         | Enable or disable S3 support for the indexing system | `true`  |
| `s3Client.endpoint`        | S3 endpoint address                                  | `""`    |
| `s3Client.accessKeyId`     | S3 access key ID                                     | `""`    |
| `s3Client.secretAccessKey` | S3 secret access key                                 | `""`    |
| `s3Client.bucket`          | S3 bucket name                                       | `""`    |
| `s3Client.useSsl`          | Enable or disable SSL                                | `false` |

### Syncer settings

| Name                                   | Description                                                                                              | Value                                    |
| -------------------------------------- | -------------------------------------------------------------------------------------------------------- | ---------------------------------------- |
| `syncer.ports.http`                    | HTTP port for REST API requests of the indexing system                                                   | `8088`                                   |
| `syncer.loglevel`                      | Log level; can be `trace`, `debug`, `info`, `warning`, `error`, or `critical`                            | `info`                                   |
| `syncer.image.repository`              | Docker image repository                                                                                  | `docker-hub.2gis.ru/usrch/bs-syncer_new` |
| `syncer.image.pullPolicy`              | Image [pull policy](https://kubernetes.io/docs/concepts/containers/images/#image-pull-policy)            | `IfNotPresent`                           |
| `syncer.image.tag`                     | Docker image tag                                                                                         | `0.3`                                    |
| `syncer.securityContext`               | Kubernetes [SecurityContext](https://kubernetes.io/docs/tasks/configure-pod-container/security-context/) | `{}`                                     |
| `syncer.resources.requests.cpu`        | CPU request; recommended value: `20m`                                                                    |                                          |
| `syncer.resources.requests.memory`     | Memory request; recommended value: `128Mi`                                                               |                                          |
| `syncer.resources.limits.cpu`          | CPU limit; recommended value: `100m`                                                                     |                                          |
| `syncer.resources.limits.memory`       | Memory limit; recommended value: `256Mi`                                                                 |                                          |
| `syncer.initResources.requests.cpu`    | CPU request for the syncer init container; recommended value: `500m`                                     |                                          |
| `syncer.initResources.requests.memory` | Memory request for the syncer init container; recommended value: `128Mi`                                 |                                          |
| `syncer.initResources.limits.cpu`      | CPU limit for the syncer init container; recommended value: `2000m`                                      |                                          |
| `syncer.initResources.limits.memory`   | Memory limit for the syncer init container; recommended value: `256Mi`                                   |                                          |
| `syncer.endpoints.rtw`                 | Endpoint for downloading real-time weights                                                               | `""`                                     |
| `syncer.endpoints.aiSuggestedQueries`  | Endpoint for downloading AI Suggested Queries                                                            | `""`                                     |
| `GIN_MODE`                             | Go application operating mode; default is `release`, `debug` mode is also supported                      | `release`                                |

### Magg settings

| Name                                      | Description                                                                                                                                                                                                          | Value                                         |
| ----------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | --------------------------------------------- |
| `magg.enabled`                            | Enable or disable the metrics aggregator container                                                                                                                                                                   | `true`                                        |
| `magg.image.repository`                   | Docker image repository                                                                                                                                                                                              | `docker-hub.2gis.ru/usrch/metrics-aggregator` |
| `magg.image.pullPolicy`                   | Image [pull policy](https://kubernetes.io/docs/concepts/containers/images/#image-pull-policy)                                                                                                                        | `IfNotPresent`                                |
| `magg.image.tag`                          | Docker image tag                                                                                                                                                                                                     | `master`                                      |
| `magg.ports.metrics`                      | HTTP port for Prometheus to scrape metrics                                                                                                                                                                           | `9999`                                        |
| `magg.resources.requests.cpu`             | CPU request; recommended value: `10m`                                                                                                                                                                                |                                               |
| `magg.resources.requests.memory`          | Memory request; recommended value: `32Mi`                                                                                                                                                                            |                                               |
| `magg.resources.limits.cpu`               | CPU limit; recommended value: `100m`                                                                                                                                                                                 |                                               |
| `magg.resources.limits.memory`            | Memory limit; recommended value: `128Mi`                                                                                                                                                                             |                                               |
| `serviceAccount.create`                   | Specifies whether a ServiceAccount should be created                                                                                                                                                                 | `false`                                       |
| `serviceAccount.automount`                | Set to `false` to opt out of automounting API credentials. See [credential automounting](https://kubernetes.io/docs/tasks/configure-pod-container/configure-service-account/#opt-out-of-api-credential-automounting) | `false`                                       |
| `serviceAccount.annotations`              | Annotations to add to the ServiceAccount                                                                                                                                                                             | `{}`                                          |
| `serviceAccount.name`                     | Name of the ServiceAccount to use                                                                                                                                                                                    | `""`                                          |
| `service.worker.port`                     | Service (svc) port for the worker                                                                                                                                                                                    | `8091`                                        |
| `service.head.type`                       | Service (svc) type for the head component                                                                                                                                                                            | `ClusterIP`                                   |
| `service.head.port`                       | Service (svc) port for the head component                                                                                                                                                                            | `8080`                                        |
| `service.head.external.enable`            | Temporary internal 2GIS parameter for On-Prem; should be disabled                                                                                                                                                    | `false`                                       |
| `service.filesStorage.port`               | Service (svc) port for the filesStorage component                                                                                                                                                                    | `80`                                          |
| `service.controller.port`                 | Service (svc) port for the controller component                                                                                                                                                                      | `80`                                          |
| `service.indexer.port`                    | Service (svc) port for the indexer component                                                                                                                                                                         | `80`                                          |
| `service.ingress_router.port`             | Service (svc) port for the ingress-router                                                                                                                                                                            | `9092`                                        |
| `service.geodetector.port`                | Service (svc) port for the geodetector component                                                                                                                                                                     | `10091`                                       |
| `service.queryTransformerMock.ports.http` | Service (svc) HTTP port for the queryTransformerMock                                                                                                                                                                 | `8000`                                        |
| `service.queryTransformerMock.ports.grpc` | Service (svc) gRPC port for the queryTransformerMock                                                                                                                                                                 | `8091`                                        |

### queryTransformerMock

| Name                                             | Description                                                                                                  | Value                                             |
| ------------------------------------------------ | ------------------------------------------------------------------------------------------------------------ | ------------------------------------------------- |
| `queryTransformerMock.enabled`                   | Enable or disable the queryTransformerMock component                                                         | `false`                                           |
| `queryTransformerMock.image.repository`          | Docker image repository                                                                                      | `docker-hub.2gis.ru/usrch/query-transformer-mock` |
| `queryTransformerMock.image.pullPolicy`          | Image [pull policy](https://kubernetes.io/docs/concepts/containers/images/#image-pull-policy)                | `IfNotPresent`                                    |
| `queryTransformerMock.image.tag`                 | Docker image tag                                                                                             | `master_9290908e`                                 |
| `queryTransformerMock.imagePullSecrets`          | Kubernetes image pull secrets                                                                                | `[]`                                              |
| `queryTransformerMock.replicaCount`              | Number of replicas for queryTransformerMock (used if HPA is disabled)                                        | `1`                                               |
| `queryTransformerMock.ports.grpc`                | gRPC port                                                                                                    | `50051`                                           |
| `queryTransformerMock.ports.http`                | HTTP port                                                                                                    | `8000`                                            |
| `queryTransformerMock.resources.requests.cpu`    | CPU request; recommended value: `50m`                                                                        |                                                   |
| `queryTransformerMock.resources.requests.memory` | Memory request; recommended value: `100Mi`                                                                   |                                                   |
| `queryTransformerMock.resources.limits.cpu`      | CPU limit; recommended value: `1`                                                                            |                                                   |
| `queryTransformerMock.resources.limits.memory`   | Memory limit; recommended value: `8Gi`                                                                       |                                                   |
| `queryTransformerMock.podSecurityContext`        | Kubernetes [podSecurityContext](https://kubernetes.io/docs/tasks/configure-pod-container/security-context/)  | `{}`                                              |
| `queryTransformerMock.securityContext`           | Kubernetes [SecurityContext](https://kubernetes.io/docs/tasks/configure-pod-container/security-context/)     | `{}`                                              |
| `queryTransformerMock.podLabels`                 | Kubernetes [pod labels](https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/)           | `{}`                                              |
| `queryTransformerMock.podAnnotations`            | Kubernetes [pod annotations](https://kubernetes.io/docs/concepts/overview/working-with-objects/annotations/) | `{}`                                              |
| `queryTransformerMock.matchLabels`               | Selector match labels                                                                                        | `{}`                                              |

### ingress_router

| Name                                                               | Description                                                                                                                                                   | Value                                        |
| ------------------------------------------------------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------- | -------------------------------------------- |
| `ingress_router.enabled`                                           | Enable or disable ingress_router                                                                                                                              | `true`                                       |
| `ingress_router.replicaCount`                                      | Number of replicas for ingress_router (used if HPA is disabled)                                                                                               | `1`                                          |
| `ingress_router.livenessProbe.enabled`                             | Enable liveness probe                                                                                                                                         | `true`                                       |
| `ingress_router.livenessProbe.httpGet.path`                        | HTTP path for the liveness probe                                                                                                                              | `/status`                                    |
| `ingress_router.livenessProbe.httpGet.port`                        | HTTP port for the liveness probe                                                                                                                              | `ingress-router`                             |
| `ingress_router.livenessProbe.httpGet.scheme`                      | HTTP scheme for the liveness probe                                                                                                                            | `HTTP`                                       |
| `ingress_router.livenessProbe.timeoutSeconds`                      | Timeout (in seconds) for the liveness probe                                                                                                                   | `1`                                          |
| `ingress_router.livenessProbe.periodSeconds`                       | Interval (in seconds) between liveness probe checks                                                                                                           | `5`                                          |
| `ingress_router.livenessProbe.successThreshold`                    | Minimum consecutive successes for the liveness probe                                                                                                          | `1`                                          |
| `ingress_router.livenessProbe.failureThreshold`                    | Number of failures before the liveness probe is considered failed                                                                                             | `4`                                          |
| `ingress_router.readinessProbe.enabled`                            | Enable readiness probe                                                                                                                                        | `true`                                       |
| `ingress_router.readinessProbe.httpGet.path`                       | HTTP path for the readiness probe                                                                                                                             | `/status`                                    |
| `ingress_router.readinessProbe.httpGet.port`                       | HTTP port for the readiness probe                                                                                                                             | `ingress-router`                             |
| `ingress_router.readinessProbe.httpGet.scheme`                     | HTTP scheme for the readiness probe                                                                                                                           | `HTTP`                                       |
| `ingress_router.readinessProbe.timeoutSeconds`                     | Timeout (in seconds) for the readiness probe                                                                                                                  | `1`                                          |
| `ingress_router.readinessProbe.periodSeconds`                      | Interval (in seconds) between readiness probe checks                                                                                                          | `5`                                          |
| `ingress_router.readinessProbe.successThreshold`                   | Minimum consecutive successes for the readiness probe                                                                                                         | `1`                                          |
| `ingress_router.readinessProbe.failureThreshold`                   | Number of failures before the readiness probe is considered failed                                                                                            | `2`                                          |
| `ingress_router.startupProbe.enabled`                              | Enable startup probe                                                                                                                                          | `true`                                       |
| `ingress_router.startupProbe.httpGet.path`                         | HTTP path for the startup probe                                                                                                                               | `/status`                                    |
| `ingress_router.startupProbe.httpGet.port`                         | HTTP port for the startup probe                                                                                                                               | `ingress-router`                             |
| `ingress_router.startupProbe.httpGet.scheme`                       | HTTP scheme for the startup probe                                                                                                                             | `HTTP`                                       |
| `ingress_router.startupProbe.initialDelaySeconds`                  | Initial delay (in seconds) before starting the startup probe                                                                                                  | `5`                                          |
| `ingress_router.startupProbe.timeoutSeconds`                       | Timeout (in seconds) for the startup probe                                                                                                                    | `1`                                          |
| `ingress_router.startupProbe.periodSeconds`                        | Interval (in seconds) between startup probe checks                                                                                                            | `5`                                          |
| `ingress_router.startupProbe.successThreshold`                     | Minimum consecutive successes for the startup probe                                                                                                           | `1`                                          |
| `ingress_router.startupProbe.failureThreshold`                     | Number of failures before the startup probe is considered failed                                                                                              | `5`                                          |
| `ingress_router.loggerLevel`                                       | Log level; can be `trace`, `debug`, `info`, `warning`, `error`, or `critical`                                                                                 | `info`                                       |
| `ingress_router.loggerFormat`                                      | Log format; Userver supports `tskv`, `ltsv`, `raw`, `json`, `json_yadeploy`. Recommended: `json`                                                              | `json`                                       |
| `ingress_router.resources.requests.cpu`                            | CPU request; recommended value: `1`                                                                                                                           |                                              |
| `ingress_router.resources.requests.memory`                         | Memory request; recommended value: `400Mi`                                                                                                                    |                                              |
| `ingress_router.resources.limits.cpu`                              | CPU limit; recommended value: `2`                                                                                                                             |                                              |
| `ingress_router.resources.limits.memory`                           | Memory limit; recommended value: `2Gi`                                                                                                                        |                                              |
| `ingress_router.hpa.enabled`                                       | Enable or disable Horizontal Pod Autoscaler (HPA)                                                                                                             | `true`                                       |
| `ingress_router.hpa.minReplicas`                                   | Minimum number of replicas                                                                                                                                    | `2`                                          |
| `ingress_router.hpa.maxReplicas`                                   | Maximum number of replicas                                                                                                                                    | `5`                                          |
| `ingress_router.hpa.averageCPUValue`                               | Target average CPU utilization (as a direct value of requested CPU)                                                                                           | `700m`                                       |
| `ingress_router.hpa.behavior.scaleDown.policies[0].periodSeconds`  | Duration (in seconds) the policy must be true                                                                                                                 | `180`                                        |
| `ingress_router.hpa.behavior.scaleDown.policies[0].type`           | Type of scaling (percentage or absolute number of pods to reduce)                                                                                             | `Percent`                                    |
| `ingress_router.hpa.behavior.scaleDown.policies[0].value`          | Number or percentage of pods to reduce                                                                                                                        | `3`                                          |
| `ingress_router.hpa.behavior.scaleDown.stabilizationWindowSeconds` | Stabilization window to prevent flapping                                                                                                                      | `1200`                                       |
| `ingress_router.hpa.behavior.scaleUp.selectPolicy`                 | Policy selection strategy: `Min` or `Disabled`                                                                                                                | `Min`                                        |
| `ingress_router.hpa.behavior.scaleUp.policies[0].periodSeconds`    | Duration (in seconds) the policy must be true                                                                                                                 | `15`                                         |
| `ingress_router.hpa.behavior.scaleUp.policies[0].type`             | Type of scaling (percentage or absolute number of pods to increase)                                                                                           | `Percent`                                    |
| `ingress_router.hpa.behavior.scaleUp.policies[0].value`            | Number or percentage of pods to increase                                                                                                                      | `10`                                         |
| `ingress_router.hpa.behavior.scaleUp.policies[1].periodSeconds`    | Duration (in seconds) the policy must be true                                                                                                                 | `15`                                         |
| `ingress_router.hpa.behavior.scaleUp.policies[1].type`             | Type of scaling (percentage or absolute number of pods to increase)                                                                                           | `Pods`                                       |
| `ingress_router.hpa.behavior.scaleUp.policies[1].value`            | Number or percentage of pods to increase                                                                                                                      | `5`                                          |
| `ingress_router.hpa.behavior.scaleUp.stabilizationWindowSeconds`   | Stabilization window to prevent flapping                                                                                                                      | `30`                                         |
| `ingress_router.vpa.enabled`                                       | Enable or disable Vertical Pod Autoscaler (VPA)                                                                                                               | `true`                                       |
| `ingress_router.vpa.updateMode`                                    | VPA operating mode; `Off` means no automatic resource changes                                                                                                 | `Off`                                        |
| `ingress_router.imagePullSecrets`                                  | Kubernetes image pull secrets                                                                                                                                 | `[]`                                         |
| `ingress_router.experimentComponent.enabled`                       | Enable or disable A/B experiments                                                                                                                             | `false`                                      |
| `ingress_router.rateLimitComponent.enabled`                        | Enable or disable rate limiting                                                                                                                               | `false`                                      |
| `ingress_router.prestopHook.enabled`                               | Enable or disable container lifecycle [preStop hook](https://kubernetes.io/docs/concepts/containers/container-lifecycle-hooks/)                               | `true`                                       |
| `ingress_router.podSecurityContext`                                | Kubernetes [podSecurityContext](https://kubernetes.io/docs/tasks/configure-pod-container/security-context/)                                                   | `{}`                                         |
| `ingress_router.envoy.securityContext`                             | Kubernetes [SecurityContext](https://kubernetes.io/docs/tasks/configure-pod-container/security-context/)                                                      | `{}`                                         |
| `ingress_router.envoy.image.repository`                            | Docker image repository                                                                                                                                       | `envoyproxy/envoy`                           |
| `ingress_router.envoy.image.pullPolicy`                            | Image [pull policy](https://kubernetes.io/docs/concepts/containers/images/#image-pull-policy)                                                                 | `IfNotPresent`                               |
| `ingress_router.envoy.image.tag`                                   | Docker image tag                                                                                                                                              | `v1.28.0`                                    |
| `ingress_router.envoy.resources.requests.cpu`                      | CPU request; recommended value: `200m`                                                                                                                        |                                              |
| `ingress_router.envoy.resources.requests.memory`                   | Memory request; recommended value: `128Mi`                                                                                                                    |                                              |
| `ingress_router.envoy.resources.limits.cpu`                        | CPU limit; recommended value: `800m`                                                                                                                          |                                              |
| `ingress_router.envoy.resources.limits.memory`                     | Memory limit; recommended value: `512Mi`                                                                                                                      |                                              |
| `ingress_router.envoy.ports.admin`                                 | HTTP port for Envoy admin console                                                                                                                             | `9901`                                       |
| `ingress_router.envoy.ports.grpc`                                  | gRPC port used by Envoy                                                                                                                                       | `8091`                                       |
| `ingress_router.tolerations`                                       | Kubernetes [tolerations](https://kubernetes.io/docs/concepts/scheduling-eviction/taint-and-toleration/) settings                                              | `[]`                                         |
| `ingress_router.nodeSelector`                                      | Kubernetes [node selectors](https://kubernetes.io/docs/concepts/scheduling-eviction/assign-pod-node/#nodeselector)                                            | `{}`                                         |
| `ingress_router.affinity`                                          | Kubernetes pod [affinity settings](https://kubernetes.io/docs/concepts/scheduling-eviction/assign-pod-node/#node-affinity)                                    | `{}`                                         |
| `ingress_router.strategy.type`                                     | Deployment strategy; can be `Recreate` or `RollingUpdate`. See [Strategy](https://kubernetes.io/docs/concepts/workloads/controllers/deployment/#strategy)     | `RollingUpdate`                              |
| `ingress_router.strategy.rollingUpdate.maxUnavailable`             | Maximum number of unavailable pods during a [rolling update](https://kubernetes.io/docs/concepts/workloads/controllers/deployment/#rolling-update-deployment) | `25%`                                        |
| `ingress_router.strategy.rollingUpdate.maxSurge`                   | Maximum number of extra pods during a [rolling update](https://kubernetes.io/docs/concepts/workloads/controllers/deployment/#rolling-update-deployment)       | `25%`                                        |
| `ingress_router.image.repository`                                  | Docker image repository                                                                                                                                       | `docker-hub.2gis.ru/usrch/bs-ingress_router` |
| `ingress_router.image.pullPolicy`                                  | Image [pull policy](https://kubernetes.io/docs/concepts/containers/images/#image-pull-policy)                                                                 | `IfNotPresent`                               |
| `ingress_router.image.tag`                                         | Docker image tag                                                                                                                                              | `test_5`                                     |
| `ingress_router.matchLabels`                                       | Selector match labels                                                                                                                                         | `{}`                                         |
| `ingress_router.podLabels`                                         | Kubernetes [pod labels](https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/)                                                            | `{}`                                         |
| `ingress_router.sapphire_url`                                      | Custom URL for the `head` service                                                                                                                             | `""`                                         |
| `ingress_router.sapphire_request_timeout_ms`                       | Timeout (in ms) for requests to the `head` service                                                                                                            | `5000`                                       |
| `ingress_router.prometheus_url`                                    | Prometheus URL for rate limiting                                                                                                                              | `""`                                         |
| `ingress_router.rate_limit_rules`                                  | Big Search usage quotas                                                                                                                                       | `[]`                                         |
| `ingress_router.ports.monitor`                                     | TCP port for service endpoints such as `/metrics`                                                                                                             | `9093`                                       |
| `ingress_router.ports.http`                                        | TCP port for API requests                                                                                                                                     | `9092`                                       |
| `ingress_router.headers`                                           | Header used for A/B experiment routing                                                                                                                        | `X-Sapphire-Index`                           |
| `ingress_router.ab.sapphire_base.port`                             | Port of the AB Sapphire base service                                                                                                                          | `8080`                                       |
| `ingress_router.ab.sapphire_base.exact_match`                      | Header value for AB Sapphire base                                                                                                                             | `0`                                          |
| `ingress_router.ab.contour1.port`                                  | Port of AB experiment 1 head service                                                                                                                          | `9092`                                       |
| `ingress_router.ab.contour1.address`                               | Address of AB experiment 1 head service                                                                                                                       | `big-search-dev-2-ingress-router`            |
| `ingress_router.ab.contour1.exact_match`                           | Header value for AB experiment 1                                                                                                                              | `1`                                          |
| `ingress_router.ab.contour2.port`                                  | Port of AB experiment 2 head service                                                                                                                          | `9092`                                       |
| `ingress_router.ab.contour2.address`                               | Address of AB experiment 2 head service                                                                                                                       | `big-search-stg-green-ingress-router`        |
| `ingress_router.ab.contour2.exact_match`                           | Header value for AB experiment 2                                                                                                                              | `2`                                          |
| `ingress_router.ab.contour3.port`                                  | Port of AB experiment 3 head service                                                                                                                          | `9092`                                       |
| `ingress_router.ab.contour3.address`                               | Address of AB experiment 3 head service                                                                                                                       | `big-search-dev-5-ingress-router`            |
| `ingress_router.ab.contour3.exact_match`                           | Header value for AB experiment 3                                                                                                                              | `3`                                          |

### geodetector

| Name                                                            | Description                                                                                                                                                   | Value                                     |
| --------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------- |
| `geodetector.enabled`                                           | Enable or disable the geodetector service                                                                                                                     | `true`                                    |
| `geodetector.replicaCount`                                      | Number of replicas for geodetector (used if HPA is disabled)                                                                                                  | `1`                                       |
| `geodetector.image.repository`                                  | Docker image repository                                                                                                                                       | `docker-hub.2gis.ru/usrch/bs-geodetector` |
| `geodetector.image.pullPolicy`                                  | Image [pull policy](https://kubernetes.io/docs/concepts/containers/images/#image-pull-policy)                                                                 | `IfNotPresent`                            |
| `geodetector.image.tag`                                         | Docker image tag                                                                                                                                              | `test_5`                                  |
| `geodetector.imagePullSecrets`                                  | Kubernetes image pull secrets                                                                                                                                 | `[]`                                      |
| `geodetector.geodetector_grpc_threads`                          | Number of threads for gRPC execution                                                                                                                          | `2`                                       |
| `geodetector.data_update_frequency_sec`                         | Frequency (in seconds) of index information updates                                                                                                           | `60`                                      |
| `geodetector.geodetector_main_threads`                          | Number of threads per main handler                                                                                                                            | `4`                                       |
| `geodetector.geodetector_fs_threads`                            | Number of threads for FS task processor                                                                                                                       | `2`                                       |
| `geodetector.geodetector_mon_threads`                           | Number of threads allocated for collecting metrics                                                                                                            | `2`                                       |
| `geodetector.loggerLevel`                                       | Log level; can be `trace`, `debug`, `info`, `warning`, `error`, or `critical`                                                                                 | `info`                                    |
| `geodetector.loggerFormat`                                      | Log format; Userver supports `tskv`, `ltsv`, `raw`, `json`, `json_yadeploy`. Recommended: `json`                                                              | `json`                                    |
| `geodetector.executeDebugCommands`                              | Enable execution of debug commands (e.g., simulate crash)                                                                                                     | `true`                                    |
| `geodetector.matchLabels`                                       | Selector match labels                                                                                                                                         | `{}`                                      |
| `geodetector.podLabels`                                         | Kubernetes [pod labels](https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/)                                                            | `{}`                                      |
| `geodetector.podAnnotations`                                    | Kubernetes [pod annotations](https://kubernetes.io/docs/concepts/overview/working-with-objects/annotations/)                                                  | `{}`                                      |
| `geodetector.podSecurityContext`                                | Kubernetes [podSecurityContext](https://kubernetes.io/docs/tasks/configure-pod-container/security-context/)                                                   | `{}`                                      |
| `geodetector.securityContext`                                   | Kubernetes [SecurityContext](https://kubernetes.io/docs/tasks/configure-pod-container/security-context/)                                                      | `{}`                                      |
| `geodetector.hpa.enabled`                                       | Enable or disable Horizontal Pod Autoscaler (HPA)                                                                                                             | `true`                                    |
| `geodetector.hpa.minReplicas`                                   | Minimum number of replicas                                                                                                                                    | `2`                                       |
| `geodetector.hpa.maxReplicas`                                   | Maximum number of replicas                                                                                                                                    | `3`                                       |
| `geodetector.hpa.averageCPUValue`                               | Target average CPU utilization (as a direct value of requested CPU)                                                                                           | `700m`                                    |
| `geodetector.hpa.behavior.scaleDown.policies[0].periodSeconds`  | Duration (in seconds) the policy must be true                                                                                                                 | `180`                                     |
| `geodetector.hpa.behavior.scaleDown.policies[0].type`           | Type of scaling (percentage or absolute number of pods to reduce)                                                                                             | `Percent`                                 |
| `geodetector.hpa.behavior.scaleDown.policies[0].value`          | Number or percentage of pods to reduce                                                                                                                        | `3`                                       |
| `geodetector.hpa.behavior.scaleDown.stabilizationWindowSeconds` | Stabilization window to prevent flapping                                                                                                                      | `1200`                                    |
| `geodetector.hpa.behavior.scaleUp.selectPolicy`                 | Policy selection strategy: `Min` or `Disabled`                                                                                                                | `Min`                                     |
| `geodetector.hpa.behavior.scaleUp.policies[0].periodSeconds`    | Duration (in seconds) the policy must be true                                                                                                                 | `15`                                      |
| `geodetector.hpa.behavior.scaleUp.policies[0].type`             | Type of scaling (percentage or absolute number of pods to increase)                                                                                           | `Percent`                                 |
| `geodetector.hpa.behavior.scaleUp.policies[0].value`            | Number or percentage of pods to increase                                                                                                                      | `10`                                      |
| `geodetector.hpa.behavior.scaleUp.policies[1].periodSeconds`    | Duration (in seconds) the policy must be true                                                                                                                 | `15`                                      |
| `geodetector.hpa.behavior.scaleUp.policies[1].type`             | Type of scaling (percentage or absolute number of pods to increase)                                                                                           | `Pods`                                    |
| `geodetector.hpa.behavior.scaleUp.policies[1].value`            | Number or percentage of pods to increase                                                                                                                      | `5`                                       |
| `geodetector.hpa.behavior.scaleUp.stabilizationWindowSeconds`   | Stabilization window to prevent flapping                                                                                                                      | `30`                                      |
| `geodetector.vpa.enabled`                                       | Enable or disable Vertical Pod Autoscaler (VPA)                                                                                                               | `true`                                    |
| `geodetector.vpa.updateMode`                                    | VPA operating mode; `Off` means no automatic resource changes                                                                                                 | `Off`                                     |
| `geodetector.ports.grpc`                                        | gRPC port for API requests                                                                                                                                    | `10091`                                   |
| `geodetector.ports.server`                                      | gRPC server port                                                                                                                                              | `10092`                                   |
| `geodetector.ports.monitor`                                     | Port for Prometheus metrics                                                                                                                                   | `10093`                                   |
| `geodetector.resources.requests.cpu`                            | CPU request; recommended value: `1`                                                                                                                           |                                           |
| `geodetector.resources.requests.memory`                         | Memory request; recommended value: `4000Mi`                                                                                                                   |                                           |
| `geodetector.resources.limits.cpu`                              | CPU limit; recommended value: `2`                                                                                                                             |                                           |
| `geodetector.resources.limits.memory`                           | Memory limit; recommended value: `6Gi`                                                                                                                        |                                           |
| `geodetector.data.resources.requests.storage`                   | Requested storage volume size                                                                                                                                 | `8Gi`                                     |
| `geodetector.data.storageClassName`                             | Storage class to use; see Kubernetes [storageClassName](https://kubernetes.io/docs/concepts/storage/storage-classes/)                                         | `""`                                      |
| `geodetector.data.persistent.enabled`                           | Enable or disable persistent volume for the service                                                                                                           | `true`                                    |
| `geodetector.livenessProbe.enabled`                             | Enable liveness probe                                                                                                                                         | `true`                                    |
| `geodetector.livenessProbe.httpGet.path`                        | HTTP path for the liveness probe                                                                                                                              | `/status`                                 |
| `geodetector.livenessProbe.httpGet.port`                        | HTTP port for the liveness probe                                                                                                                              | `geodetector-srv`                         |
| `geodetector.livenessProbe.httpGet.scheme`                      | HTTP scheme for the liveness probe                                                                                                                            | `HTTP`                                    |
| `geodetector.livenessProbe.timeoutSeconds`                      | Timeout (in seconds) for the liveness probe                                                                                                                   | `1`                                       |
| `geodetector.livenessProbe.periodSeconds`                       | Interval (in seconds) between liveness probe checks                                                                                                           | `5`                                       |
| `geodetector.livenessProbe.successThreshold`                    | Minimum consecutive successes for the liveness probe                                                                                                          | `1`                                       |
| `geodetector.livenessProbe.failureThreshold`                    | Number of failures before the liveness probe is considered failed                                                                                             | `36`                                      |
| `geodetector.readinessProbe.enabled`                            | Enable readiness probe                                                                                                                                        | `true`                                    |
| `geodetector.readinessProbe.httpGet.path`                       | HTTP path for the readiness probe                                                                                                                             | `/status`                                 |
| `geodetector.readinessProbe.httpGet.port`                       | HTTP port for the readiness probe                                                                                                                             | `geodetector-srv`                         |
| `geodetector.readinessProbe.httpGet.scheme`                     | HTTP scheme for the readiness probe                                                                                                                           | `HTTP`                                    |
| `geodetector.readinessProbe.timeoutSeconds`                     | Timeout (in seconds) for the readiness probe                                                                                                                  | `1`                                       |
| `geodetector.readinessProbe.periodSeconds`                      | Interval (in seconds) between readiness probe checks                                                                                                          | `5`                                       |
| `geodetector.readinessProbe.successThreshold`                   | Minimum consecutive successes for the readiness probe                                                                                                         | `1`                                       |
| `geodetector.readinessProbe.failureThreshold`                   | Number of failures before the readiness probe is considered failed                                                                                            | `3`                                       |
| `geodetector.startupProbe.enabled`                              | Enable startup probe                                                                                                                                          | `true`                                    |
| `geodetector.startupProbe.httpGet.path`                         | HTTP path for the startup probe                                                                                                                               | `/ready`                                  |
| `geodetector.startupProbe.httpGet.port`                         | HTTP port for the startup probe                                                                                                                               | `http-syncer`                             |
| `geodetector.startupProbe.httpGet.scheme`                       | HTTP scheme for the startup probe                                                                                                                             | `HTTP`                                    |
| `geodetector.startupProbe.initialDelaySeconds`                  | Initial delay (in seconds) before starting the startup probe                                                                                                  | `30`                                      |
| `geodetector.startupProbe.timeoutSeconds`                       | Timeout (in seconds) for the startup probe                                                                                                                    | `2`                                       |
| `geodetector.startupProbe.periodSeconds`                        | Interval (in seconds) between startup probe checks                                                                                                            | `10`                                      |
| `geodetector.startupProbe.successThreshold`                     | Minimum consecutive successes for the startup probe                                                                                                           | `1`                                       |
| `geodetector.startupProbe.failureThreshold`                     | Number of failures before the startup probe is considered failed                                                                                              | `200`                                     |
| `geodetector.prestopHook.enabled`                               | Enable or disable container lifecycle [preStop hook](https://kubernetes.io/docs/concepts/containers/container-lifecycle-hooks/)                               | `true`                                    |
| `geodetector.strategy.type`                                     | Deployment strategy; can be `Recreate` or `RollingUpdate`. See [Strategy](https://kubernetes.io/docs/concepts/workloads/controllers/deployment/#strategy)     | `RollingUpdate`                           |
| `geodetector.strategy.rollingUpdate.maxUnavailable`             | Maximum number of unavailable pods during a [rolling update](https://kubernetes.io/docs/concepts/workloads/controllers/deployment/#rolling-update-deployment) | `25%`                                     |
| `geodetector.strategy.rollingUpdate.maxSurge`                   | Maximum number of extra pods during a [rolling update](https://kubernetes.io/docs/concepts/workloads/controllers/deployment/#rolling-update-deployment)       | `25%`                                     |
| `geodetector.nodeSelector`                                      | Kubernetes [node selectors](https://kubernetes.io/docs/concepts/scheduling-eviction/assign-pod-node/#nodeselector)                                            | `{}`                                      |
| `geodetector.tolerations`                                       | Kubernetes [tolerations](https://kubernetes.io/docs/concepts/scheduling-eviction/taint-and-toleration/) settings                                              | `[]`                                      |
| `geodetector.affinity`                                          | Kubernetes pod [affinity settings](https://kubernetes.io/docs/concepts/scheduling-eviction/assign-pod-node/#node-affinity)                                    | `{}`                                      |

### Ingress settings

| Name                                 | Description                                        | Value                    |
| ------------------------------------ | -------------------------------------------------- | ------------------------ |
| `ingress.enabled`                    | Enable or disable Ingress for the service          | `false`                  |
| `ingress.className`                  | Name of the Ingress controller class               | `nginx`                  |
| `ingress.annotations`                | Annotations to apply to the Ingress resource       | `{}`                     |
| `ingress.hosts[0].host`              | Hostname for the Ingress service                   | `big-search.example.com` |
| `ingress.hosts[0].paths[0].path`     | Path for the specified host in the Ingress service | `/`                      |
| `ingress.hosts[0].paths[0].pathType` | Type of path matching (e.g., `Prefix`, `Exact`)    | `ImplementationSpecific` |
| `ingress.tls`                        | TLS configuration for the Ingress resource         | `[]`                     |

### customCAs **Custom Certificate Authority**

| Name                  | Description                                                                                                                | Value   |
| --------------------- | -------------------------------------------------------------------------------------------------------------------------- | ------- |
| `customCAs.bundle`    | Custom CA [text representation of an X.509 PEM public-key certificate](https://www.rfc-editor.org/rfc/rfc7468#section-5.1) | `""`    |
| `customCAs.certsPath` | Mount path for the custom CA bundle inside the container. If empty, the default is: "/usr/local/share/ca-certificates"     | `""`    |
| `onpremise`           | Enable specific parameters for on-premise deployment                                                                       | `false` |

### Deployment Artifacts Storage settings

| Name                     | Description                                                                                                                                                                                                                                             | Value   |
| ------------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------- |
| `dgctlStorage.host`      | S3 endpoint. Format: `host:port`                                                                                                                                                                                                                        | `""`    |
| `dgctlStorage.bucket`    | S3 bucket name                                                                                                                                                                                                                                          | `""`    |
| `dgctlStorage.accessKey` | S3 access key for accessing the bucket                                                                                                                                                                                                                  | `""`    |
| `dgctlStorage.secretKey` | S3 secret key for accessing the bucket                                                                                                                                                                                                                  | `""`    |
| `dgctlStorage.manifest`  | The path to the [manifest file](https://docs.2gis.com/en/on-premise/overview#nav-lvl2@paramCommon_deployment_steps). Format: `manifests/0000000000.json` <br> This file contains the description of pieces of data that the service requires to operate | `1`     |
| `dgctlStorage.secure`    | If S3 uses https.                                                                                                                                                                                                                                       | `false` |
| `dgctlStorage.region`    | S3 region                                                                                                                                                                                                                                               | `""`    |
