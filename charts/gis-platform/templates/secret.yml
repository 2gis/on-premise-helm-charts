{{- /*
    helm cannot into type conversions
    https://github.com/helm/helm/issues/1707
*/}}
{{-
    $dbc := printf "Server=%s;Port=%d;User Id=%s;Password=%s;Database=%s;Maximum Pool Size=%d;"
                .Values.spcore.postgres.host
               (.Values.spcore.postgres.port | int)
                .Values.spcore.postgres.username
                .Values.spcore.postgres.password
                .Values.spcore.postgres.name
               (.Values.spcore.postgres.poolsize | int)
-}}
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "gis-platform.secret" . }}
  labels:
    {{- include "gis-platform-spcore.labels" . | nindent 4 }}
type: Opaque
data:
  s3_access_key: {{ .Values.spcore.s3.accessKey | b64enc | quote }}
  s3_secret_key: {{ .Values.spcore.s3.secretKey | b64enc | quote }}
  db_connection_string: {{ $dbc | b64enc | quote }}
  admin_password: {{ .Values.spcore.admin.password | b64enc | quote }}
  jwt_token_admin: {{ .Values.spcore.jwt.tokenAdmin | b64enc | quote }}
  jwt_token_key: {{ .Values.spcore.jwt.tokenKey | b64enc | quote }}
  gis_platform_catalog_key: {{ .Values.spcore.catalog.key | b64enc | quote }}
