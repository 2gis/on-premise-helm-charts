---
bases:
- ../base.yaml
---
{{ $type := ""}}
{{ $rule := ""}}
{{ if eq ( requiredEnv "API" ) "directions_car" }} {{ $type = "carrouting" }} {{ $rule = "cr" }}
{{ else if eq ( requiredEnv "API" ) "directions_ped" }} {{ $type = "pedestrian" }} {{ $rule = "pd" }}
{{ else if eq ( requiredEnv "API" ) "directions_bic" }} {{ $type = "bicycle" }} {{ $rule = "bc" }}
{{ else if eq ( requiredEnv "API" ) "directions_taxi" }} {{ $type = "taxi" }} {{ $rule = "tx" }}
{{ else if eq ( requiredEnv "API" ) "distance_matrix" }} {{ $type = "dm" }} {{ $rule = "dm" }}
{{ else if eq ( requiredEnv "API" ) "public_transport" }} {{ $type = "ctx" }} {{ $rule = "pt" }}
{{ else if eq ( requiredEnv "API" ) "pairs" }} {{ $type = "pairs" }} {{ $rule = "pr" }}
{{ else if eq ( requiredEnv "API" ) "truck" }} {{ $type = "truck" }} {{ $rule = "tr" }}
{{ else }}
{{ fail "API env is wrong" }}
{{ end }}

releases:
  - name: navi-back-{{ $rule }}
    chart:  ../../charts/navi-back
    namespace: {{ .Values.namespace  }}
    kubeContext: {{ .Values.kubeContext }}
    version: "{{ .Values.version }}"
    timeout: 3600
    labels:
      service: '{{`{{ .Release.Name }}`}}'
    values: 
      - ../values/dgctl.yaml
      - ../values/navi-back-custom.yaml
    {{- if .Values.customProjectNavi }}
      - ../values/navi-custom-rules.yaml # использовать проекты, описанные в rules.conf
    {{ end }}
    set:
      - name: naviback.app_rule
        value: {{ $rule }}
      - name: naviback.type
        value: {{ $type }}


